<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Store - Mua Game Giá Tốt</title>
    <style>
        :root {
            --primary-color: #6c5ce7;
            --secondary-color: #a29bfe;
            --dark-bg: #1e293b;
            --darker-bg: #0f172a;
            --text-light: #f1f5f9;
            --card-bg: #2d3748;
            --price-color: #a855f7;
            --sale-color: #e74c3c;
            --success-color: #27ae60;
            --warning-color: #f39c12;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--darker-bg);
            color: var(--text-light);
            line-height: 1.6;
            padding-bottom: 50px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--dark-bg);
            padding: 15px 0;
            margin-bottom: 30px;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .site-logo {
            display: flex;
            align-items: center;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            margin-right: 10px;
            background-color: var(--primary-color);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px;
        }

        .logo-text {
            font-size: 22px;
            font-weight: bold;
        }

        .logo-highlight {
            color: var(--primary-color);
        }

        .search-form {
            flex-grow: 1;
            margin: 0 30px;
            max-width: 500px;
        }

        .search-input {
            width: 100%;
            padding: 10px 15px;
            border-radius: 25px;
            border: none;
            background-color: var(--card-bg);
            color: var(--text-light);
        }

        .user-menu {
            display: flex;
            align-items: center;
        }

        .menu-item {
            margin-left: 15px;
            cursor: pointer;
            padding: 8px 15px;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        .menu-item:hover {
            background-color: var(--card-bg);
        }

        .login-btn {
            background-color: var(--primary-color);
            padding: 8px 15px;
            border-radius: 5px;
            text-decoration: none;
            color: white;
            font-weight: bold;
        }

        .hero-section {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            padding: 40px 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .hero-title {
            font-size: 2rem;
            margin-bottom: 15px;
        }

        .hero-text {
            font-size: 1.1rem;
            margin-bottom: 20px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero-button {
            background-color: var(--dark-bg);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .hero-button:hover {
            transform: scale(1.05);
        }

        .categories {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
        }

        .category {
            background-color: var(--card-bg);
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .category.active {
            background-color: var(--primary-color);
        }

        .category:hover {
            background-color: var(--primary-color);
        }

        .section-title {
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .view-all {
            color: var(--secondary-color);
            text-decoration: none;
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .game-card {
            background-color: var(--card-bg);
            border-radius: 10px;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .game-image {
            width: 100%;
            aspect-ratio: 16/9;
            object-fit: cover;
        }

        .game-content {
            padding: 15px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .game-title {
            font-size: 1.1rem;
            margin-bottom: 10px;
            flex-grow: 1;
        }

        .game-categories {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 15px;
        }

        .game-category {
            background-color: var(--dark-bg);
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 0.75rem;
        }

        .hot-category {
            background-color: var(--sale-color);
        }

        .action-category {
            background-color: #e17055;
        }

        .rpg-category {
            background-color: #00b894;
        }

        .strategy-category {
            background-color: #0984e3;
        }

        .sport-category {
            background-color: #6c5ce7;
        }

        .game-price-box {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .game-price {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--price-color);
        }

        .price-original {
            text-decoration: line-through;
            color: #999;
            margin-right: 8px;
            font-size: 0.9rem;
        }

        .price-sale {
            color: var(--sale-color);
        }

        .add-cart-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .add-cart-btn:hover {
            background-color: var(--secondary-color);
        }

        .sale-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--sale-color);
            color: white;
            padding: 5px 10px;
            border-radius: 3px;
            font-weight: bold;
        }

        .game-card-wrapper {
            position: relative;
        }

        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 30px;
            gap: 5px;
        }

        .pagination-btn {
            background-color: var(--dark-bg);
            color: var(--text-light);
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .pagination-btn:hover, .pagination-btn.active {
            background-color: var(--primary-color);
        }

        .pagination-btn:disabled {
            background-color: var(--darker-bg);
            cursor: not-allowed;
            opacity: 0.5;
        }

        .no-games {
            background-color: var(--card-bg);
            padding: 30px;
            border-radius: 10px;
            text-align: center;
        }

        .filter-section {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .filter-title {
            margin-bottom: 15px;
            font-weight: bold;
        }

        .price-filter {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .price-input {
            width: 120px;
            padding: 8px;
            border-radius: 5px;
            border: none;
            background-color: var(--dark-bg);
            color: var(--text-light);
        }

        .filter-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        .filter-reset {
            background-color: var(--dark-bg);
        }

        footer {
            background-color: var(--dark-bg);
            padding: 30px 0;
            margin-top: 50px;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
        }

        .footer-section h3 {
            margin-bottom: 15px;
            color: var(--secondary-color);
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 10px;
        }

        .footer-links a {
            color: var(--text-light);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer-links a:hover {
            color: var(--secondary-color);
        }

        .copyright {
            text-align: center;
            padding-top: 20px;
            margin-top: 20px;
            border-top: 1px solid var(--card-bg);
            color: #a0aec0;
        }

        .admin-link {
            color: var(--secondary-color);
            text-decoration: none;
            margin-left: 10px;
        }

        .error-message {
            background-color: var(--sale-color);
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
        }

        @media screen and (max-width: 768px) {
            .search-form {
                margin: 0 10px;
            }

            .games-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            
            .header-content {
                flex-wrap: wrap;
            }
            
            .search-form {
                order: 3;
                margin-top: 10px;
                max-width: 100%;
            }
        }

        @media screen and (max-width: 576px) {
            .games-grid {
                grid-template-columns: 1fr;
            }
            
            .user-menu {
                display: none;
            }
            
            .game-card-wrapper {
                max-width: 300px;
                margin: 0 auto;
            }
            
            .category {
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="site-logo">
                <div class="logo-icon">G</div>
                <div class="logo-text">Game<span class="logo-highlight">Store</span></div>
            </div>
            
            <form class="search-form">
                <input type="text" id="searchInput" class="search-input" placeholder="Tìm kiếm game...">
            </form>
            
            <div class="user-menu">
                <div class="menu-item">Giỏ hàng (0)</div>
                <a href="login.html" class="login-btn">Đăng nhập</a>
            </div>
        </div>
    </header>

    <div class="container">
        <div id="errorMessage" class="error-message" style="display: none;">
            Không thể tải dữ liệu game!
        </div>

        <section class="hero-section">
            <h1 class="hero-title">Khám Phá Thế Giới Game</h1>
            <p class="hero-text">Tham gia vào cuộc phiêu lưu với bộ sưu tập game đa dạng của chúng tôi. Từ hành động gay cấn đến chiến thuật chiến đấu, chúng tôi có mọi thứ cho mọi game thủ.</p>
            <button class="hero-button">Xem Game Hot</button>
        </section>

        <section class="filter-section">
            <h3 class="filter-title">Bộ lọc</h3>
            <div class="categories">
                <div class="category active" data-category="all">Tất cả</div>
                <div class="category" data-category="action">Hành Động</div>
                <div class="category" data-category="rpg">Nhập Vai</div>
                <div class="category" data-category="strategy">Chiến Thuật</div>
                <div class="category" data-category="sport">Thể Thao</div>
                <div class="category" data-category="hot">Game Hot</div>
                <div class="category" data-category="sale">Game Giảm Giá</div>
            </div>
            
            <div class="price-filter">
                <div class="filter-group">
                    <label for="minPrice">Giá từ:</label>
                    <input type="number" id="minPrice" class="price-input" placeholder="VND">
                </div>
                <div class="filter-group">
                    <label for="maxPrice">Đến:</label>
                    <input type="number" id="maxPrice" class="price-input" placeholder="VND">
                </div>
                <button id="applyFilter" class="filter-btn">Lọc</button>
                <button id="resetFilter" class="filter-btn filter-reset">Đặt lại</button>
            </div>
        </section>

        <section>
            <h2 class="section-title">
                <span id="gamesTitle">Tất cả game</span>
                <span id="gameCount"></span>
            </h2>
            
            <div id="gamesGrid" class="games-grid">
                <!-- Games will be displayed here -->
            </div>
            
            <div id="pagination" class="pagination">
                <!-- Pagination buttons will be here -->
            </div>
        </section>

    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>Game Store</h3>
                <p>Cửa hàng game trực tuyến với nhiều ưu đãi hấp dẫn và dịch vụ chăm sóc khách hàng tận tâm.</p>
            </div>
            
            <div class="footer-section">
                <h3>Liên kết</h3>
                <ul class="footer-links">
                    <li><a href="#">Trang chủ</a></li>
                    <li><a href="#">Game mới</a></li>
                    <li><a href="#">Game hot</a></li>
                    <li><a href="#">Game giảm giá</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>Hỗ trợ</h3>
                <ul class="footer-links">
                    <li><a href="#">Trung tâm hỗ trợ</a></li>
                    <li><a href="#">FAQ</a></li>
                    <li><a href="#">Liên hệ</a></li>
                    <li><a href="#">Chính sách</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>Liên hệ</h3>
                <ul class="footer-links">
                    <li>Email: support@gamestore.com</li>
                    <li>Điện thoại: +84 123 456 789</li>
                    <li>Địa chỉ: 123 Đường Game, TP. Hồ Chí Minh</li>
                </ul>
            </div>
        </div>
        
        <div class="copyright">
            &copy; 2025 Game Store. Tất cả quyền được bảo lưu.
            <a href="admin.html" class="admin-link">Admin</a>
        </div>
    </footer>

    <script>
      // Variables
let games = [];
let filteredGames = [];
let currentPage = 1;
const gamesPerPage = 10;
let activeCategory = 'all';
let minPriceFilter = null;
let maxPriceFilter = null;
let searchFilter = '';
let saleConfig = {
    enabled: true,
    minThreshold: 0,
    maxThreshold: 10000000,
    type: 'fixed',
    salePrice: 199000,
    salePercent: 30
};
let discountCodes = [];

// DOM Elements
const gamesGrid = document.getElementById('gamesGrid');
const pagination = document.getElementById('pagination');
const errorMessage = document.getElementById('errorMessage');
const gameCount = document.getElementById('gameCount');
const gamesTitle = document.getElementById('gamesTitle');
const searchInput = document.getElementById('searchInput');
const categoryButtons = document.querySelectorAll('.category');
const minPriceInput = document.getElementById('minPrice');
const maxPriceInput = document.getElementById('maxPrice');
const applyFilterBtn = document.getElementById('applyFilter');
const resetFilterBtn = document.getElementById('resetFilter');
const heroButton = document.querySelector('.hero-button');

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    loadGames();
    
    // Event listeners
    searchInput.addEventListener('input', handleSearch);
    categoryButtons.forEach(btn => {
        btn.addEventListener('click', () => handleCategoryFilter(btn.dataset.category));
    });
    
    applyFilterBtn.addEventListener('click', applyPriceFilter);
    resetFilterBtn.addEventListener('click', resetFilters);
    heroButton.addEventListener('click', () => handleCategoryFilter('hot'));
});

// Load games from localStorage
function loadGames() {
    try {
        const storedGames = localStorage.getItem('games');
        if (storedGames) {
            games = JSON.parse(storedGames);
            console.log('Loaded games:', games.length);
            
            // Ensure all games have required properties
            games.forEach(game => {
                if (!game.hasOwnProperty('originalPrice')) {
                    game.originalPrice = game.price;
                }
            });
            
            // Load sale config
            loadSaleConfig();
            
            // Áp dụng giảm giá cho games
            applyDiscountsToGames();
            
            // Apply initial filtering
            applyFilters();
        } else {
            showError('Không tìm thấy dữ liệu game!');
        }
    } catch (error) {
        console.error('Error loading games:', error);
        showError('Lỗi khi tải dữ liệu game!');
    }
}

// Load sale configuration from localStorage
function loadSaleConfig() {
    try {
        const storedSaleConfig = localStorage.getItem('saleConfig');
        if (storedSaleConfig) {
            saleConfig = JSON.parse(storedSaleConfig);
            console.log('Loaded sale config:', saleConfig);
        }
        
        // Load discount codes
        const storedCodes = localStorage.getItem('discountCodes');
        if (storedCodes) {
            discountCodes = JSON.parse(storedCodes);
            console.log('Loaded discount codes:', discountCodes);
        }
    } catch (error) {
        console.error('Error loading sale config:', error);
    }
}

// Thêm hàm này để áp dụng giảm giá cho mỗi game khi tải trang
function applyDiscountsToGames() {
    games.forEach(game => {
        // Kiểm tra game có đủ điều kiện áp dụng chương trình giảm giá toàn cục
        if (isGameOnSale(game)) {
            // Nếu giá chưa được giảm, thực hiện giảm giá
            if (game.price === game.originalPrice) {
                // Tính toán giá giảm dựa trên loại giảm giá
                if (saleConfig.type === 'fixed') {
                    game.price = Math.min(game.originalPrice, saleConfig.salePrice);
                } else {
                    // Tính toán phần trăm giảm giá
                    const discountAmount = Math.round(game.originalPrice * (saleConfig.salePercent / 100));
                    game.price = Math.max(1, game.originalPrice - discountAmount);
                }
            }
        } else {
            // Kiểm tra mã giảm giá có thể áp dụng
            const discountCode = getApplicableDiscountCode(game);
            if (discountCode) {
                game.price = calculateDiscountedPrice(game.originalPrice, discountCode);
            }
        }
    });
    
    console.log('Applied discounts to games. Games on sale:', 
                games.filter(g => g.price !== g.originalPrice).length);
}

// Check if a game is eligible for the global sale
function isGameOnSale(game) {
    return saleConfig.enabled && 
           game.originalPrice >= saleConfig.minThreshold && 
           (saleConfig.maxThreshold === null || saleConfig.maxThreshold === 0 || game.originalPrice <= saleConfig.maxThreshold);
}

// Get applicable discount code for a game
function getApplicableDiscountCode(game) {
    if (!discountCodes || discountCodes.length === 0) return null;
    
    // Find a valid discount code for this game
    for (const code of discountCodes) {
        if (game.originalPrice >= (code.minPrice || 0) && 
            (code.maxPrice === null || code.maxPrice === 0 || game.originalPrice <= code.maxPrice)) {
            return code;
        }
    }
    
    return null;
}

// Calculate price with discount code applied
function calculateDiscountedPrice(originalPrice, discountCode) {
    if (!discountCode) return originalPrice;
    
    if (discountCode.type === 'fixed') {
        return Math.max(1, originalPrice - discountCode.amount);
    } else {
        const discountAmount = Math.round(originalPrice * (discountCode.amount / 100));
        return Math.max(1, originalPrice - discountAmount);
    }
}

// Get the sale price for a game based on global settings
function getGameSalePrice(game) {
    if (isGameOnSale(game)) {
        if (saleConfig.type === 'fixed') {
            return Math.min(game.originalPrice, saleConfig.salePrice); // Ensure sale price isn't higher than original
        } else {
            // Calculate percentage discount
            const discountAmount = Math.round(game.originalPrice * (saleConfig.salePercent / 100));
            return Math.max(1, game.originalPrice - discountAmount);
        }
    }
    return game.originalPrice;
}

// Get the discount percentage for a game
function getDiscountPercentage(originalPrice, salePrice) {
    if (!originalPrice || !salePrice || originalPrice <= salePrice) return 0;
    return Math.round((1 - salePrice / originalPrice) * 100);
}

// Get discount info for display
function getDiscountInfo(game) {
    // Check for actual sale price different from original
    if (game.price === game.originalPrice) {
        return {
            isOnSale: false,
            percentage: 0,
            discountType: null,
            finalPrice: game.price
        };
    }
    
    // Game is on sale
    const percentage = getDiscountPercentage(game.originalPrice, game.price);
    
    // Check if game is eligible for global sale
    if (isGameOnSale(game)) {
        return {
            isOnSale: true,
            percentage: percentage,
            discountType: saleConfig.type === 'fixed' ? 'fixed' : 'percent',
            discountValue: saleConfig.type === 'fixed' ? saleConfig.salePrice : saleConfig.salePercent,
            finalPrice: game.price
        };
    }
    
    // Check if game has discount code
    const discountCode = getApplicableDiscountCode(game);
    if (discountCode) {
        return {
            isOnSale: true,
            percentage: percentage,
            discountType: discountCode.type,
            discountValue: discountCode.amount,
            discountCode: discountCode.code,
            finalPrice: game.price
        };
    }
    
    // Generic sale (price was manually adjusted)
    return {
        isOnSale: true,
        percentage: percentage,
        discountType: 'manual',
        finalPrice: game.price
    };
}

// Apply all filters and render games
function applyFilters() {
    // Start with all games
    filteredGames = [...games];
    
    // Apply category filter
    if (activeCategory !== 'all') {
        if (activeCategory === 'sale') {
            // Show games on sale (price different from original price)
            filteredGames = filteredGames.filter(game => 
                game.price !== game.originalPrice
            );
        } else {
            // Filter by category
            filteredGames = filteredGames.filter(game => 
                game.categories && game.categories.includes(activeCategory)
            );
        }
    }
    
    // Apply price filter
    if (minPriceFilter !== null) {
        filteredGames = filteredGames.filter(game => game.price >= minPriceFilter);
    }
    
    if (maxPriceFilter !== null) {
        filteredGames = filteredGames.filter(game => game.price <= maxPriceFilter);
    }
    
    // Apply search filter
    if (searchFilter && searchFilter.trim() !== '') {
        const searchTerm = searchFilter.trim().toLowerCase();
        filteredGames = filteredGames.filter(game => 
            game.title.toLowerCase().includes(searchTerm)
        );
    }
    
    // Reset to first page when filters change
    currentPage = 1;
    
    // Update page title based on active filter
    updatePageTitle();
    
    // Render filtered games
    renderGames();
}

// Update page title based on active filter
function updatePageTitle() {
    let title = '';
    
    switch (activeCategory) {
        case 'all':
            title = 'Tất cả game';
            break;
        case 'action':
            title = 'Game Hành Động';
            break;
        case 'rpg':
            title = 'Game Nhập Vai';
            break;
        case 'strategy':
            title = 'Game Chiến Thuật';
            break;
        case 'sport':
            title = 'Game Thể Thao';
            break;
        case 'hot':
            title = 'Game Hot';
            break;
        case 'sale':
            title = 'Game Giảm Giá';
            break;
        default:
            title = 'Game';
    }
    
    gamesTitle.textContent = title;
    gameCount.textContent = `(${filteredGames.length})`;
}

// Format price with thousands separator
function formatPrice(price) {
    return price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
}

// Handle search input
function handleSearch() {
    searchFilter = searchInput.value;
    applyFilters();
}

// Handle category filter
function handleCategoryFilter(category) {
    activeCategory = category;
    
    // Update active category button
    categoryButtons.forEach(btn => {
        if (btn.dataset.category === category) {
            btn.classList.add('active');
        } else {
            btn.classList.remove('active');
        }
    });
    
    applyFilters();
}

// Apply price filter
function applyPriceFilter() {
    minPriceFilter = minPriceInput.value ? parseInt(minPriceInput.value) : null;
    maxPriceFilter = maxPriceInput.value ? parseInt(maxPriceInput.value) : null;
    
    applyFilters();
}

// Reset all filters
function resetFilters() {
    activeCategory = 'all';
    minPriceFilter = null;
    maxPriceFilter = null;
    searchFilter = '';
    
    // Reset UI
    categoryButtons.forEach(btn => {
        if (btn.dataset.category === 'all') {
            btn.classList.add('active');
        } else {
            btn.classList.remove('active');
        }
    });
    
    minPriceInput.value = '';
    maxPriceInput.value = '';
    searchInput.value = '';
    
    applyFilters();
}

// Render games with pagination
function renderGames() {
    // Calculate total pages and current page items
    const totalPages = Math.ceil(filteredGames.length / gamesPerPage);
    const startIndex = (currentPage - 1) * gamesPerPage;
    const endIndex = Math.min(startIndex + gamesPerPage, filteredGames.length);
    const currentGames = filteredGames.slice(startIndex, endIndex);
    
    // Render games
    if (currentGames.length === 0) {
        gamesGrid.innerHTML = `
            <div class="no-games">
                <h3>Không tìm thấy game nào phù hợp</h3>
                <p>Vui lòng thử điều chỉnh bộ lọc</p>
            </div>
        `;
        pagination.innerHTML = '';
        return;
    }
    
    // Generate HTML for games
    const gamesHTML = currentGames.map(game => {
        // Get discount information
        const discountInfo = getDiscountInfo(game);
        
        // Generate category badges
        const categoriesHTML = game.categories.map(category => {
            const categoryClass = category === 'hot' ? 'hot-category' : 
                                category === 'action' ? 'action-category' : 
                                category === 'rpg' ? 'rpg-category' : 
                                category === 'strategy' ? 'strategy-category' : 
                                category === 'sport' ? 'sport-category' : '';
                                
            return `<span class="game-category ${categoryClass}">${getCategoryName(category)}</span>`;
        }).join('');
        
        // Add sale category badge if on sale
        let saleCategory = '';
        if (discountInfo.isOnSale) {
            saleCategory = `<span class="game-category hot-category">Giảm ${discountInfo.percentage}%</span>`;
        }
        
        // Generate price display
        let priceHTML = '';
        if (discountInfo.isOnSale) {
            priceHTML = `
                <span class="price-original">${formatPrice(game.originalPrice)}</span>
                <span class="price-sale">${formatPrice(game.price)}</span> VND
            `;
        } else {
            priceHTML = `${formatPrice(game.price)} VND`;
        }
        
        // Sale badge
        let saleBadge = '';
        let discountTypeBadge = '';
        if (discountInfo.isOnSale) {
            saleBadge = `<div class="sale-badge">-${discountInfo.percentage}%</div>`;
            
            // Show discount type badge if applicable
            if (discountInfo.discountType === 'fixed') {
                discountTypeBadge = `<div class="discount-type-badge">Giá cố định: ${formatPrice(discountInfo.discountValue)}đ</div>`;
            } else if (discountInfo.discountType === 'percent') {
                discountTypeBadge = `<div class="discount-type-badge">Giảm: ${discountInfo.discountValue}%</div>`;
            } else if (discountInfo.discountCode) {
                discountTypeBadge = `<div class="discount-type-badge">Mã: ${discountInfo.discountCode}</div>`;
            }
        }
        
        return `
        <div class="game-card-wrapper">
            ${saleBadge}
            ${discountTypeBadge}
            <div class="game-card">
                <img src="${game.image}" alt="${game.title}" class="game-image">
                <div class="game-content">
                    <h3 class="game-title">${game.title}</h3>
                    <div class="game-categories">
                        ${categoriesHTML}
                        ${saleCategory}
                    </div>
                    <div class="game-price-box">
                        <div class="game-price">${priceHTML}</div>
                        <button class="add-cart-btn">Mua</button>
                    </div>
                </div>
            </div>
        </div>
        `;
    }).join('');
    
    gamesGrid.innerHTML = gamesHTML;
    
    // Render pagination
    renderPagination(totalPages);
}

// Convert category id to display name
function getCategoryName(category) {
    switch(category) {
        case 'action':
            return 'Hành Động';
        case 'rpg':
            return 'Nhập Vai';
        case 'strategy':
            return 'Chiến Thuật';
        case 'sport':
            return 'Thể Thao';
        case 'hot':
            return 'Hot';
        case 'other':
            return 'Khác';
        default:
            return category;
    }
}

// Render pagination controls
function renderPagination(totalPages) {
    if (totalPages <= 1) {
        pagination.innerHTML = '';
        return;
    }
    
    let paginationHTML = '';
    
    // Previous button
    paginationHTML += `
        <button class="pagination-btn" ${currentPage === 1 ? 'disabled' : ''} onclick="changePage(${currentPage - 1})">
            &laquo;
        </button>
    `;
    
    // Page buttons
    if (totalPages <= 7) {
        // Show all pages if 7 or fewer
        for (let i = 1; i <= totalPages; i++) {
            paginationHTML += `
                <button class="pagination-btn ${currentPage === i ? 'active' : ''}" onclick="changePage(${i})">
                    ${i}
                </button>
            `;
        }
    } else {
        // Show first page
        paginationHTML += `
            <button class="pagination-btn ${currentPage === 1 ? 'active' : ''}" onclick="changePage(1)">
                1
            </button>
        `;
        
        // Show ellipsis or pages
        if (currentPage > 3) {
            paginationHTML += `<button class="pagination-btn" disabled>...</button>`;
        }
        
        // Show pages around current page
        const startPage = Math.max(2, currentPage - 1);
        const endPage = Math.min(totalPages - 1, currentPage + 1);
        
        for (let i = startPage; i <= endPage; i++) {
            paginationHTML += `
                <button class="pagination-btn ${currentPage === i ? 'active' : ''}" onclick="changePage(${i})">
                    ${i}
                </button>
            `;
        }
        
        // Show ellipsis or pages
        if (currentPage < totalPages - 2) {
            paginationHTML += `<button class="pagination-btn" disabled>...</button>`;
        }
        
        // Show last page
        paginationHTML += `
            <button class="pagination-btn ${currentPage === totalPages ? 'active' : ''}" onclick="changePage(${totalPages})">
                ${totalPages}
            </button>
        `;
    }
    
    // Next button
    paginationHTML += `
        <button class="pagination-btn" ${currentPage === totalPages ? 'disabled' : ''} onclick="changePage(${currentPage + 1})">
            &raquo;
        </button>
    `;
    
    pagination.innerHTML = paginationHTML;
}

// Change current page
function changePage(page) {
    currentPage = page;
    renderGames();
    // Scroll back to top of games section
    gamesGrid.scrollIntoView({ behavior: 'smooth' });
}

// Show error message
function showError(message) {
    errorMessage.textContent = message;
    errorMessage.style.display = 'block';
}

// Make changePage function global
window.changePage = changePage;
    </script>
</body>
</html>
